<polymer-element name="dmw-sensor" attributes="sensorid sensorkey sensorvalue sensorhistory">
	<template>
	    <web-socket id="socket"></web-socket>
	</template>
	<script>
		Polymer("dmw-sensor", {
			ready:function(){
				this.isSet = false;
			},
			statReceived: function(topic, json) {
		        this.sensorvalue=json.stored_value;
		        this.fire('sensor-statreceived', {stat: json});
		    },
			historyReceived: function(topic, json) {
		        this.sensorhistory=json['history'];
		    },
		    sensoridChanged: function(oldValue, newValue) {
		    	this.$.socket.register('device-stats', this.statReceived.bind(this), 'sensor_id', newValue);
		    	this.$.socket.register('sensor-history', this.historyReceived.bind(this), 'id', newValue);
		    },
		    init: function(sensor) {
		    	this.name = sensor['name'];
		    	this.last_value = sensor['last_value'];
		    	this.last_received = sensor['last_received'];
		    	this.sensorid = sensor['id'];
		    	this.device = sensor['device'];
		    	this.datatype_id = sensor['datatype_id'];
				this.isSet = true;
		    },
		    getHistory: function(from, to) {
		    	this.$.socket.send("sensor-gethistory", {'id': this.sensorid, 'from': from, 'to': to});
		    },
		    getLast: function(count) {
		    	this.$.socket.send("sensor-getlast", {'id': this.sensorid, 'count': count});
		    }
		});
	</script>
</polymer-element>

