<!DOCTYPE html>
<html lang="en" class="csstransforms">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Domoweb</title>
  <link rel="stylesheet" href="/libraries/bootstrap-3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/menu.css">
  <style type="text/css" id="sectionstyle">
  .widgetstyle {
    border: 1px solid {{ params['WidgetBorderColor'] }};
    background-color: {{ params['WidgetBackgroundColor'] }};
    -moz-border-radius: {{ params['WidgetBorderRadius'] }};
    -webkit-border-radius: {{ params['WidgetBorderRadius'] }};
    border-radius: {{ params['WidgetBorderRadius'] }};
    color: {{ params['WidgetTextColor'] }};
    box-shadow: {{ params['WidgetBoxShadow'] }};
  }
  body {
    background-position: {{ params['SectionBackgroundPosition'] }};
    background-repeat: {{ params['SectionBackgroundRepeat'] }};
    background-size: {{ params['SectionBackgroundSize'] }};
    background-image: {% if 'SectionBackground' in params %}url('/backgrounds/{{params['SectionBackground']}}'){% else %}{{ params['SectionBackgroundImage'] }}{% end %};
  }
  </style>
  <script src="/components/platform/platform.js"></script>
  <link rel="import" href="/components/polymer-ajax.html">
  <link rel="import" href="/components/websockets.html">
  <link rel="import" href="/components/widget.html">
  <link rel="import" href="/components/section.html">
  <!--link rel="import" href="/components/mainMenu.html"-->
  <link rel="import" href="/components/gridLayout.html">
  <link rel="import" href="/components/widgetsSelector.html">
  {% for widget in widgets %}
  <link id="{{widget.id}}" rel="import" href="/widget/{{widget.set_id}}/{{widget.set_ref}}.html">
  {% end %}
</head>
<body unresolved>
  <web-socket id="socket"></web-socket>
  <polymer-ajax id="ajax" method="POST" url="/configuration"></polymer-ajax>
  <dmw-section class='mainsection' sectionid="{{ section.id }}"></dmw-section>
	<main role="main">
    <dmw-grid-layout sectionid="{{section.id}}"></dmw-grid-layout>
    <button class="cn-button" id="cn-button"><span class='sr-only' data-i18n="menu.open"></span></button>
    <div class="cn-wrapper" id="cn-wrapper">
     <ul>
       <li><a id="menuConfigure" href="#" role='button'><span class="label" data-i18n="menu.configuration"></span><span class="icon glyphicon glyphicon-cog" aria-hidden="true"></span></a></li>
       <li><a id="menuWidgets" href="#" role='button'><span class="label" data-i18n="menu.widgets"></span><span class="icon glyphicon glyphicon-th" aria-hidden="true"></span></a></li>
       <li><a href="#" role='button'><span class="label" data-i18n="menu.home"></span><span class="icon glyphicon glyphicon-home" aria-hidden="true"></span></a></li>
       <li><a href="#" role='button'></a></li>
       <li><a href="#" role='button'><span class="label" data-i18n="menu.lock"></span><span class="icon glyphicon glyphicon-lock" aria-hidden="true"></span></a></li>
     </ul>
   </div>
   <div id="cn-overlay" class="cn-overlay"></div>
   <div id="modal-overlay"></div>
	</main>
  <script src="/libraries/jquery-1.11.0/jquery.min.js"></script>
  <script src="/libraries/bootstrap-3.1.1/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/libraries/i18next/i18next.min.js"></script>
  <script src="/libraries/d3/d3.min.js"></script>
  <script src="/js/menu.js"></script>
  <script type="text/javascript">
    var section = document.querySelector('.mainsection');
    window.onload=function() {
      section.addEventListener('section-updated', sectionUpdated);
    };
      i18n.init({
//        lng: "en-US",
        fallbackLng: 'en-US',
        resGetPath: 'locales/__ns__/__lng__/translation.json',
        ns: {
          namespaces: ['domoweb', {% for pack in packs %}'{{pack[0]}}', {% end %}], 
          defaultNs: 'domoweb'
          },
        },
        function() {
        // translate nav
        jQuery("#cn-wrapper").i18n();
      });
      function sectionUpdated(topic, json) {
        var ss = document.querySelector('#sectionstyle');
        var widgetStyle = ss.sheet.cssRules[0];
        widgetStyle.style.color=section.params['WidgetTextColor'];
        widgetStyle.style.backgroundColor=section.params['WidgetBackgroundColor'];
        widgetStyle.style.borderColor=section.params['WidgetBorderColor'];
        widgetStyle.style.borderRadius=section.params['WidgetBorderRadius'];
        widgetStyle.style.boxShadow=section.params['WidgetBoxShadow'];
        var bodyStyle = ss.sheet.cssRules[1];
        if ('SectionBackground' in section.params) {
            bodyStyle.style.backgroundImage="url('/backgrounds/" + section.params['SectionBackground'] + "')";
        } else {
            bodyStyle.style.backgroundImage=section.params['SectionBackgroundImage'];
        }
      }
  </script>
</body>
</html>

