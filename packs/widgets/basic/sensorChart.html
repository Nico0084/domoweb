    <script src="/widget/basic/js/jquery.sparkline.min.js"></script>
<polymer-element name="dmw-basic-sensorChart" extends="dmw-widget">
    <template>
        <link rel="stylesheet" href="/widget/basic/css/common.css" shim-domshadow>
        <style type="text/css">
            :host {
                height: 100%;
                display: block;
            }
            #spark {
            }
            #chart {
                float: left;
                width: 35%;
                height: 100%;

            }
            #chart span {
                height: 100%;
            }
            #values {
                float: left;
                width: 65%;
                height: 100%;
            }
            #number {
                position: relative;
                top: 43%;
                -webkit-transform: translate(-50%, -50%);
                -ms-transform: translate(-50%, -50%);
                transform: translate(-50%, -50%);
                left: 50%;
                text-align: center;
                overflow: hidden;
                display: inline-block;
                padding: 10px;
            }
            #minmax {
                position: absolute;
                bottom: 5px;
                text-align: center;
                width: 100%;
            }
            #minvalue {
            }
            #maxvalue {
            }
            #unit {
                position: absolute;
                top:5px;
                right: 5px;
                font-size: 1em;
            }
        </style>
        <dmw-sensor id='primary' sensorkey="primary" sensorvalue="{{sensorvalue}}" sensorhistory="{{history}}"></dmw-sensor>
        <shadow></shadow>
        <div id='chart'>
          <span id="spark" class="inlinesparkline">&nbsp;</span>
        </div>
        <div id='values'>
          <div id='number'>
          {{number}}
          </div>
          <div id='minmax'>
            <span id='minvalue'></span>(-)&nbsp;-&nbsp;
            <span id='maxvalue'></span>(+)
          </div>
        </div>
        <div id='unit'>{{unit}}</div>
    </template>
    <script>
        Polymer('dmw-basic-sensorChart', {
            ready: function() {
                this.super();
                this.number = "--";
                this.unit = "";
            },
            sensorsUpdated: function() {
                if (this.$.primary.isSet) {
                    this.labelprimary = this.$.primary.device['name'];
                    this.labelsecondary = this.$.primary.name;
                    this.$.primary.getCurrentDayPerHour();
                }        
            },
            sensorvalueChanged: function(oldValue, newValue) {
                var unit = this.datatypes[this.$.primary.datatype_id]['unit'];
                if (this.options['autoconvert']==1 && newValue > 0) {
                       var k = 1000;
                       var sizes = ['', 'K', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'];
                       var i = Math.floor(Math.log(newValue) / Math.log(k));
                    this.$.number.innerHTML = (newValue / Math.pow(k, i)).toPrecision(3);
                    if (unit) {
                        this.unit = sizes[i] + i18n.t("domoweb:unit", { context: this.$.primary.datatype_id, value: unit });
                    }
                } else {
                    this.$.number.innerHTML = newValue;
                    if (unit) {
                        this.unit = i18n.t("domoweb:unit", { context: this.$.primary.datatype_id, value: unit });
                    }
                }
                this.adjustText(this, this.$.number);

            },
            historyChanged: function(oldValue, newValue) { 
                var self = this;
                var chartValues = [];
                for(i=0;i<newValue.length;i++) {
                    // 5 because : [ year, month, week, day, hour, value ]
                    chartValues.push(newValue[i][5]);
                }
                // display the chart
                minvalue = Math.min.apply(Math, chartValues).toPrecision(3);
                maxvalue = Math.max.apply(Math, chartValues).toPrecision(3);
                $('#minvalue').html(minvalue);
                $('#maxvalue').html(maxvalue);
                //$('#spark').sparkline(chartValues, { height: this.clientHeight, width: 8*this.clientWidth/20 });
                $('#spark').sparkline(chartValues, { height: '100%', width: '100%' });
                $.sparkline_display_visible();
            },
            adjustText: function(parent, element) {
                var fontsize = window.getComputedStyle(element,null).getPropertyValue("font-size");
                var i = fontsize.substr(0,2);
                while ( parent.clientWidth > element.clientWidth && parent.clientHeight > element.clientHeight && i < 100){
                    element.style.fontSize = i+"px";
                    i++;
                }            
            }
        });
 
    </script>
</polymer-element>
