{% comment %}
# Copyright 2012 Domogik project

# This file is part of Domogik.
# Domogik is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# Domogik is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with Domogik.  If not, see <http://www.gnu.org/licenses/>.

# Plugin purpose 
# ==============
# Support Z-wave technology
# Implements user interface for domoweb
# ==============
# Author : Nico <nico84dev@gmail.com>
{% endcomment %}

{% load i18n %}
{% load text %}
<script type="text/javascript" src="{% url django.views.i18n.javascript_catalog %}"></script>
<script type="text/javascript" src="{{ static_design_url }}/libraries/jquery.dataTables-1.8.2/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="{{ static_design_url }}/libraries/kinetic-v4.1.2/kinetic-v4.1.2.min.js"></script>
<script type="text/javascript" src="{{ static_design_url }}/admin/js/page-admin-ozwlib.js"> </script>
<script type="text/javascript" src="{{ static_design_url }}/admin/js/page-admin-ozwkinetics.js"> </script>
<script type='text/javascript'>
$(function(){

    $("#refreshGenStats").click(function(){
        var msg = {};
        msg['command'] = "Refresh";
        var val = {};
        val['request'] ='GetGeneralStats';
        msg['value'] = SetDataToxPL (val);
        rinor.put(['api', 'command', 'ozwave', 'UI'], msg)
            .done(function(data, status, xhr){
                var messXpl = ParseAckXPL(data.xpl);
                var stats = messXpl['data'];
                if (messXpl['error'] =='no') {
                    var rows = [];
                    for (var item in HEADSTATISTIC) {
                        rows.push([HEADSTATISTIC[item], stats[item]]);
                    }
                    $('#tabGenStat').dataTable().fnClearTable(false),
                    $('#tabGenStat').dataTable().fnAddData(rows);
                    $('#elapstime').html(stats['elapsedtime'] +  ' sec.');
                    $('#msgqueue').html(stats['msqueue']);
                };
                })
            .fail(function(jqXHR, status, error){
               if (jqXHR.status == 400)
                    $.notification('error', '{% trans "Data not recept" %} (' + jqXHR.responseText + ') please check your device configuration');
            });
        return false;
    });

    $("#refreshNodeStats").click(function(){
        var msg = {};
        msg['command'] = "Refresh";
        var val = {};
        val['request'] ='GetNodeStats';
        val['node'] = parseInt($('#nodeIdStats').val());
        msg['value'] = SetDataToxPL (val);
        rinor.put(['api', 'command', 'ozwave', 'UI'], msg)
            .done(function(data, status, xhr){
                var messXpl = ParseAckXPL(data.xpl);
                var stats = messXpl['data'];
                if (messXpl['error'] =='no') {
                    var rows = [];
                    for (var item in NODESTATISTIC) {
                        if (stats[item]) {
                            rows.push([NODESTATISTIC[item], stats[item]]);
                            };
                    };
                    for (item in messXpl) {
                        if (item.indexOf('item') != -1) {
                            description = NODESTATISTIC['commandClassId'] + messXpl[item]['commandClassId'] + '<br>' + 
                                                  ' &nbsp;&nbsp;&nbsp;&nbsp; --- ' + NODESTATISTIC['sentCntCC'] + '<br>' +
                                                  ' &nbsp;&nbsp;&nbsp;&nbsp; --- ' + NODESTATISTIC['receivedCntCC'] ;
                            rows.push([description,  '<br>' + messXpl[item]['sentCnt'] + '<br>' + messXpl[item]['receivedCnt']]);
                            };
                    };
                    $('#tabNodeStat').dataTable().fnClearTable(false),
                    $('#tabNodeStat').dataTable().fnAddData(rows);
                } else {
                    $.notification('error', '{% trans "Request error" %} (' + messXpl['error'] + ') please check input');
                    };
                })
            .fail(function(jqXHR, status, error){
               if (jqXHR.status == 400)
                    $.notification('error', '{% trans "Data not recept" %} (' + jqXHR.responseText + ') please check your device configuration');
            });
        return false;
    });
    
    $("#refreshneighbors").click(function(){
        buildKineticNeighbors();
        return false;
    });

   $(document).ready(function(){
        $('#tabGenStat').dataTable({
            "bFilter": false,
            "bPaginate": false,
            "bSort": false,
            "bInfo": false,
            "bAutoWidth": false,
        } );
        $('#tabNodeStat').dataTable({
            "bFilter": false,
            "bPaginate": false,
            "bSort": false,
            "bInfo": false,
            "bAutoWidth": false,
        } );
   });
})
</script>
<section id="graphneighbors" class="subsection">
    <h2>{% trans "Zwave neighbors" %}  &nbsp;&nbsp;&nbsp;&nbsp;
        <button id='refreshneighbors' class='button icon16-action-reset'>{% trans "Refresh graph" %}</button>&nbsp;&nbsp;
        <span>  {% trans "IN BETA TESTING" %}</span>
    </h2>
    <div id="containerneighbors" ></div> 
</section>
<section id="zwstatistic" class="subsection">
    <h2>{% trans "Network statistic" %}  &nbsp;&nbsp;&nbsp;&nbsp;
        <button id='refreshGenStats' class='button icon16-action-reset'>{% trans "Refresh statistic" %}</button>&nbsp;&nbsp;
        <form id='controllerform'>
            <ul class='infos'><font size=3>
                <li>
                    <span class='label'>{% trans "Controller run time" %}   :   </span>&nbsp;<span class='subtitle' id='elapstime'><u>00:00:00</u></span>
                </li>
                 <li>
                    <span class='label'>{% trans "Number of messages in the outgoing send queue" %}  :  </span>&nbsp;<span class='subtitle' id='msgqueue'><u>0</u></span>
                </li></font> 
            </ul>
        </form>
    </h2>
    <div id='networkstat'>
        <table id='tabGenStat' class='simple'>
            <thead>
                <tr>
                    <th scope='col'>{% trans "Description" %}</th>
                    <th scope='col'>{% trans "Value" %}</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
    </table>
    </div>
</section>
<section id="nodestatistic" class="subsection">
    <h2>{% trans "Node statistic" %}  :&nbsp;
        <input id='nodeIdStats' type='text' name='nodeIdStats' size='3' value=''>&nbsp;&nbsp;&nbsp;&nbsp;
        <button id='refreshNodeStats' class='button icon16-action-reset'>{% trans "Refresh statistic" %}</button>&nbsp;&nbsp;
    </h2>
    <div id='nodestat'>
        <table id='tabNodeStat' class='simple'>
            <thead>
                <tr>
                    <th scope='col'>{% trans "Description" %}</th>
                    <th scope='col'>{% trans "Value" %}</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
    </table>
    </div>
</section>
