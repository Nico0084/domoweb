{% comment %}
# Copyright 2011 Domogik project

# This file is part of Domogik.
# Domogik is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# Domogik is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with Domogik.  If not, see <http://www.gnu.org/licenses/>.

# Author : SÃ©bastien GALLET <bibi21000@gmail.com>
{% endcomment %}

{% load i18n %}
<script type='text/javascript'>

    $(function(){
    $("#speciallist").click(function() {
            rinor.put(['api', 'command', 'cron', 'UI'], {"command":'list'})
               .done(function(data, status, xhr){
                     //alert(JSON.stringify(data));
                     var test=JSON.stringify(data);
                     var debut=test.search('devices=');
                     test=test.slice(debut+7);
                     var fin=test.search('}');
                     test=test.slice(1,fin-2);
                     //alert(test);
                     var devices=eval(test);
                     var reg=new RegExp("[|]+", "g");
                     i=0;
                     var cron_items=document.getElementById("cron_items");
                     while(cron_items.rows.length>1)
                         cron_items.deleteRow(cron_items.rows.length-1);
                     $("#cron_items tbody").append("<tr id='" + iid + "'></tr>");
                     do {
                           var device=devices[i];
                           i=i+1;
                           //alert(device);
                           var data=device.split(reg);
                           var iid=data[0];
                           var devicetype=data[1];
                           var status=data[2];
                           var runs=data[3];
                           var aps=data[4];
                           var uptime=data[5];
                           var uptimeh = parseFloat(uptime)/3600;
                           var uptimed = parseFloat(uptime)/3600/24;
                           var runtime=data[6];
                           var runtimeh = parseFloat(runtime)/3600;
                           $("#cron_items tbody").append("<tr id='" + iid + "'></tr>");
                           var tr = $("tr#"+iid);
                           tr.append("<td>" +  iid + "</td>");
                           tr.append("<td>" + devicetype + "</td>");
                           tr.append("<td>" + status + "</td>");
                           tr.append("<td>" + runs + "</td>");
                           tr.append("<td>" + aps + "</td>");
                           tr.append("<td>" + uptime + " / " + uptimeh.toFixed(2) + " / " + uptimed.toFixed(2) + "</td>");
                           tr.append("<td>" + runtime + " / " + runtimeh.toFixed(2) + "</td>");
                           tr.append("<td>" + "&nbsp;" + "</td>");
                     }
                     while (i<devices.length);
                })
                .fail(function(jqXHR, status, error){
                    if (jqXHR.status == 400)
                        $.notification('error', '{% trans "Cant get list" %} (' + jqXHR.responseText + ')');
                });
        });
    });
</script>
<section class="subsection">
    <h2>{% trans "Cron jobs" %}</h2>
    <div id='cron_list'>
        <p><button id='speciallist' class='button icon16-action-save'>{% trans "List" %}</button></p>
        <table id='cron_items' class='simple'>
            <thead>
                <tr>
                    <th scope='col'>{% trans "id" %}</th>
                    <th scope='col'>{% trans "devicetype" %}</th>
                    <th scope='col'>{% trans "status" %}</th>
                    <th scope='col'>{% trans "runs" %}</th>
                    <th scope='col'>{% trans "aps" %}</th>
                    <th scope='col'>{% trans "uptime (s/h/d)" %}</th>
                    <th scope='col'>{% trans "runtime (s/h)" %}</th>
                    <th scope='col'>{% trans "commands" %}</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</section>
