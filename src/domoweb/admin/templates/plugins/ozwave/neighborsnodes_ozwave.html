{% comment %}
# Copyright 2012 Domogik project

# This file is part of Domogik.
# Domogik is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# Domogik is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with Domogik.  If not, see <http://www.gnu.org/licenses/>.

# Plugin purpose 
# ==============
# Support Z-wave technology
# Implements user interface for domoweb
# ==============
# Author : Nico <nico84dev@gmail.com>
{% endcomment %}

{% load i18n %}
{% load text %}
<script type="text/javascript" src="{% url django.views.i18n.javascript_catalog %}"></script>
<script type="text/javascript" src="{{ static_design_url }}/libraries/jquery.dataTables-1.8.2/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="{{ static_design_url }}/libraries/kinetic-v3.10.3/kinetic-v3.10.3.js"></script>
<script type="text/javascript" src="{{ static_design_url }}/admin/js/page-admin-ozwlib.js"> </script>
<script type="text/javascript" src="{{ static_design_url }}/admin/js/page-admin-ozwkinetics.js"> </script>
<script type='text/javascript'>
$(function(){

    $("#refreshneighbors").click(function(){
        stage.reset();
        var xc= stage.getWidth() / 2;
        var yc= stage.getHeight() / 2
        var stepR = 80;
        var Ray = 100;
        var a = 0,x=0,y=0; sta=20;
        var r=100;
        for (var i=0; i<listNodes.length;i++) {
  //        $('#listenodes').html(listNodes[i].Model);
            if (listNodes[i].Type == 'Static PC Controller') {r = 40;
                x= xc;
                y= yc;
            } else {r=25;
                x= xc + Ray * Math.cos(a*Math.PI/180);
                y= yc + Ray * Math.sin(a*Math.PI/180);
                if (a > 330) { a = sta;
                    sta = sta +20;
                    Ray = Ray + stepR;
                } else { a= a + 40;
                };
            };
            listNodes[i].Cnode = new CNode(x,y,r,listNodes[i],layer);
          };
        for (var i=0; i<listNodes.length;i++)  {         
            for (var ii=0; ii<listNodes[i].Neighbors.length;ii++) {
                for (var id2=0; id2<listNodes[i].Neighbors.length;id2++) {
                    if (listNodes[id2].Node == listNodes[i].Neighbors[ii]) { 
                        Link = new CLink(listNodes[i].Cnode, listNodes[id2].Cnode, linkLayer);
                        break;
                    };
                };
            };
        };
        stage.add(linkLayer);        
        stage.add(layer);
        stage.add(tooltipLayer);
    });
    
    $(document).ready(function(){
       var T = document.getElementById("graphneighbors"); 
       stage = new Kinetic.Stage({
          container: 'containerneighbors',
          width: 850,
          height: 500
        });
        layer = new Kinetic.Layer();
        linkLayer = new Kinetic.Layer();
        $("#showneighbors").click();
        var T =document.getElementById("graphneighbors");
   });
})
</script>
<section id="graphneighbors" class="subsection">
    <h2>{% trans "Zwave neighbors" %}  &nbsp;&nbsp;&nbsp;&nbsp;
            <button id='refreshneighbors' class='button icon16-action-reset'>{% trans "Refresh neighbors" %}</button>
            <li id='listenodes'>IN BETA TEST</li>
    </h2>
    <div id="containerneighbors" style="width:360px; height:360px; margin-left: 80px;"></div>
</section>
